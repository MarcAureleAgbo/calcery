---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import FAQ from '../components/FAQ.astro';
import Container from '../components/ui/Container.astro';
import type { BreadcrumbItem, FAQItem } from '../lib/types.ts';
import type { Locale } from '../lib/i18n';

export interface Props {
  title: string;
  description: string;
  breadcrumbs?: BreadcrumbItem[];
  faqs?: FAQItem[];
  updatedAt?: string;
  tips?: string[];
  disableDisclaimer?: boolean;
  lang?: Locale;
}

const {
  title,
  description,
  breadcrumbs = [],
  faqs = [],
  updatedAt,
  tips = [],
  disableDisclaimer = false,
  lang = 'fr',
} = Astro.props;

const hasHowItWorks = Astro.slots.has('how-it-works');
const hasExamples = Astro.slots.has('examples');

const t = {
  fr: {
    free: 'Gratuit',
    noSignup: 'Sans inscription',
    localCalculation: 'Calcul local',
    privacyNotice: 'Vos données restent sur votre appareil. Aucune transmission.',
    calculator: 'Calculateur',
    quickTips: 'Conseils rapides',
    howItWorks: 'Comment ça marche',
    examples: 'Exemples',
    warningTitle: 'Avertissement important',
    warningText:
      "Les calculateurs de ce site sont fournis à titre informatif uniquement. Ils ne constituent pas un conseil financier, fiscal ou juridique. Les résultats sont approximatifs et peuvent varier selon votre situation personnelle. Nous vous recommandons de consulter un professionnel qualifié pour des conseils personnalisés.",
    faqTitle: 'Questions fréquentes',
    updatedAt: 'Dernière mise à jour :',
  },
  en: {
    free: 'Free',
    noSignup: 'No signup',
    localCalculation: 'Local calculation',
    privacyNotice: 'Your data stays on your device. No transmission.',
    calculator: 'Calculator',
    quickTips: 'Quick tips',
    howItWorks: 'How it works',
    examples: 'Examples',
    warningTitle: 'Important disclaimer',
    warningText:
      'The calculators on this site are provided for informational purposes only. They do not constitute financial, tax, or legal advice. Results are estimates and may vary depending on your personal situation. We recommend consulting a qualified professional for personalized advice.',
    faqTitle: 'Frequently asked questions',
    updatedAt: 'Last updated:',
  },
}[lang];
---

<BaseLayout title={title} description={description} lang={lang}>
  <section class="border-b border-gray-200/70 bg-gradient-to-b from-white via-gray-50/40 to-white pb-10 pt-8">
    <Container>
      <div class="mx-auto max-w-5xl">
        <Breadcrumbs items={breadcrumbs} />

        <div class="mt-4 text-center">
          <h1 class="mb-4 text-4xl font-bold leading-tight text-gray-900 md:text-6xl">{title}</h1>
          <p class="mx-auto mb-8 max-w-3xl text-lg font-light text-gray-600 md:text-xl">{description}</p>

          <div class="mb-6 flex flex-wrap justify-center gap-3">
            <span class="rounded-full border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm font-medium text-emerald-700">{t.free}</span>
            <span class="rounded-full border border-blue-200 bg-blue-50 px-4 py-2 text-sm font-medium text-blue-700">{t.noSignup}</span>
            <span class="rounded-full border border-orange-200 bg-orange-50 px-4 py-2 text-sm font-medium text-orange-700">{t.localCalculation}</span>
          </div>

          <p class="text-sm font-medium text-gray-600">{t.privacyNotice}</p>
        </div>
      </div>
    </Container>
  </section>

  <Container class="py-12">
    <div class="mx-auto max-w-5xl space-y-14">
      <section class="rounded-2xl border border-gray-200/80 bg-white/90 p-8 shadow-md backdrop-blur-sm md:p-10">
        <h2 class="mb-8 text-center text-2xl font-bold text-gray-900">{t.calculator}</h2>
        <slot />
      </section>

      {tips.length > 0 && (
        <section>
          <h2 class="mb-6 text-center text-3xl font-bold text-gray-900">{t.quickTips}</h2>
          <div class="rounded-2xl border border-gray-200 bg-white/90 p-8 shadow-sm">
            <ul class="space-y-4">
              {tips.map((tip) => (
                <li class="flex items-start gap-3">
                  <span class="mt-0.5 inline-flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-black text-sm font-bold text-white">✓</span>
                  <span class="leading-relaxed text-gray-700">{tip}</span>
                </li>
              ))}
            </ul>
          </div>
        </section>
      )}

      {hasHowItWorks && (
        <section>
          <h2 class="mb-6 text-center text-3xl font-bold text-gray-900">{t.howItWorks}</h2>
          <div class="rounded-2xl border border-gray-200 bg-white/90 p-8 shadow-sm">
            <slot name="how-it-works" />
          </div>
        </section>
      )}

      {hasExamples && (
        <section>
          <h2 class="mb-6 text-center text-3xl font-bold text-gray-900">{t.examples}</h2>
          <div class="rounded-2xl border border-gray-200 bg-white/90 p-8 shadow-sm">
            <slot name="examples" />
          </div>
        </section>
      )}

      {!disableDisclaimer && (
        <section>
          <div class="rounded-2xl border border-amber-300 bg-amber-50 p-8">
            <h2 class="mb-3 text-xl font-semibold text-amber-900">{t.warningTitle}</h2>
            <p class="leading-relaxed text-amber-900/90">{t.warningText}</p>
          </div>
        </section>
      )}

      {faqs.length > 0 && (
        <section>
          <h2 class="mb-6 text-center text-3xl font-bold text-gray-900">{t.faqTitle}</h2>
          <div class="rounded-2xl border border-gray-200 bg-white/90 p-8 shadow-sm">
            <FAQ items={faqs} />
          </div>
        </section>
      )}

      {updatedAt && <p class="pb-2 text-center text-sm text-gray-500">{t.updatedAt} {updatedAt}</p>}
    </div>
  </Container>
</BaseLayout>
