---
import '../styles/global.css';
import SEO from '../components/SEO.astro';
import Button from '../components/ui/Button.astro';

export interface Props {
  title?: string;
  description?: string;
  canonical?: string;
}

const {
  title = 'Calcery - Des calculateurs simples pour mieux gérer votre quotidien',
  description = 'Calculateurs simples et gratuits pour mieux gérer votre budget quotidien, sans inscription ni complications.',
  canonical,
} = Astro.props;
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

    <SEO title={title} description={description} canonical={canonical} />
  </head>

  <body>
    <div class="animated-background" aria-hidden="true">
      <div class="dot-grid"></div>
      <div class="gradient-orb orb-1"></div>
      <div class="gradient-orb orb-2"></div>
      <div class="gradient-orb orb-3"></div>
      <div class="particles" id="particles"></div>
    </div>

    <header class="site-header" id="site-header">
      <nav class="site-nav" aria-label="Navigation principale">
        <a href="/" class="logo">Calcery</a>

        <ul class="nav-links">
          <li><a href="/">Accueil</a></li>
          <li><a href="/calculateurs">Calculateurs</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/a-propos">À propos</a></li>
          <li><Button href="/contact" class="nav-cta">Contact</Button></li>
        </ul>

        <button class="mobile-menu-btn" id="mobile-menu-btn" type="button" aria-label="Ouvrir le menu" aria-controls="mobile-menu" aria-expanded="false">
          <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </nav>

      <div class="mobile-menu" id="mobile-menu">
        <a href="/">Accueil</a>
        <a href="/calculateurs">Calculateurs</a>
        <a href="/blog">Blog</a>
        <a href="/a-propos">À propos</a>
        <Button href="/contact" class="nav-cta w-full justify-start">Contact</Button>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>Calcery</h3>
          <p>
            Des calculateurs simples et gratuits pour mieux gérer votre budget quotidien, sans inscription ni complications.
          </p>
        </div>

        <div class="footer-section">
          <h4>Navigation</h4>
          <ul class="footer-links">
            <li><a href="/">Accueil</a></li>
            <li><a href="/calculateurs">Calculateurs</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/a-propos">À propos</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Outils Populaires</h4>
          <ul class="footer-links">
            <li><a href="/calculateurs/budget-mensuel">Budget mensuel</a></li>
            <li><a href="/calculateurs/epargne-automatique">Épargne</a></li>
            <li><a href="/calculateurs/pourboire">Pourboire</a></li>
            <li><a href="/calculateurs/epargne-automatique">Investissement</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Légal</h4>
          <ul class="footer-links">
            <li><a href="/mentions-legales">Mentions légales</a></li>
            <li><a href="/confidentialite">Confidentialité</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2026 Calcery. Tous les droits réservés. | Créé avec ❤️ pour vous</p>
      </div>
    </footer>

    <button class="scroll-top" id="scroll-top" type="button" aria-label="Retour en haut">
      <svg width="24" height="24" fill="none" stroke="white" stroke-width="2.5" aria-hidden="true">
        <path d="M18 15l-6-6-6 6" />
      </svg>
    </button>

    <script>
      // Détection device
      const isMobile = /Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent);
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

      // Génération des particules selon le device
      function createParticles() {
        const container = document.getElementById('particles');
        if (!container) return;

        const count = isMobile ? 20 : 40;
        container.innerHTML = '';

        for (let i = 0; i < count; i += 1) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.animationDelay = `${Math.random() * 20}s`;
          particle.style.animationDuration = `${15 + Math.random() * 15}s`;
          container.appendChild(particle);
        }
      }

      createParticles();

      // Header scrolled + bouton scroll top avec RAF
      const header = document.getElementById('site-header');
      const scrollTop = document.getElementById('scroll-top');
      let scrollTicking = false;

      function updateOnScroll() {
        const y = window.pageYOffset;

        if (header) {
          if (y > 100) {
            header.classList.add('scrolled');
          } else {
            header.classList.remove('scrolled');
          }
        }

        if (scrollTop) {
          if (y > 400) {
            scrollTop.classList.add('visible');
          } else {
            scrollTop.classList.remove('visible');
          }
        }

        scrollTicking = false;
      }

      window.addEventListener('scroll', () => {
        if (!scrollTicking) {
          window.requestAnimationFrame(updateOnScroll);
          scrollTicking = true;
        }
      }, { passive: true });

      // Menu mobile
      const menuButton = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');

      if (menuButton && mobileMenu) {
        menuButton.addEventListener('click', () => {
          const isOpen = mobileMenu.classList.toggle('open');
          menuButton.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        });
      }

      // Retour en haut
      if (scrollTop) {
        scrollTop.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      // Révélation progressive des cartes au scroll
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const target = entry.target;
            target.style.opacity = '1';
            target.style.transform = 'translateY(0)';
          }
        });
      }, {
        threshold: isMobile ? 0.05 : 0.1,
        rootMargin: isMobile ? '0px 0px -50px 0px' : '0px 0px -100px 0px',
      });

      document.querySelectorAll('.tool-card, .feature-card, .step-card').forEach((card) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
      });

      // Feedback tactile
      if (isTouch) {
        document.querySelectorAll('.tool-card, .btn, .feature-badge, .mobile-menu-btn').forEach((element) => {
          element.addEventListener('touchstart', function onTouchStart() {
            this.style.transform = 'scale(0.97)';
          }, { passive: true });

          element.addEventListener('touchend', function onTouchEnd() {
            this.style.transform = '';
          }, { passive: true });
        });
      }

      // Réduction animations en batterie faible
      if (navigator.getBattery) {
        navigator.getBattery().then((battery) => {
          if (!battery.charging && battery.level < 0.2) {
            document.body.classList.add('reduce-motion');
          }
        }).catch(() => {
          // Ignore proprement les navigateurs qui refusent l'API.
        });
      }
    </script>
  </body>
</html>
