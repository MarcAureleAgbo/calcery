---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Container from '../../../components/ui/Container.astro';
import ToolCard from '../../../components/ToolCard.astro';
import Breadcrumbs from '../../../components/Breadcrumbs.astro';
import {
  getCategoryStaticPaths,
  getCategoryRoute,
  getCalculatorRoute,
  type CategoryDefinition,
  type CalculatorDefinition,
} from '../../../lib/calculator-taxonomy';
import type { BreadcrumbItem } from '../../../lib/types';

export function getStaticPaths() {
  return getCategoryStaticPaths('fr');
}

interface Props {
  category: CategoryDefinition;
  calculators: CalculatorDefinition[];
}

const { category, calculators } = Astro.props as Props;

const breadcrumbs: BreadcrumbItem[] = [
  { name: 'Accueil', item: '/' },
  { name: category.name.fr, item: getCategoryRoute('fr', category.key) },
];

const primaryCtaHref = calculators.length
  ? getCalculatorRoute('fr', calculators[0].slug)
  : getCategoryRoute('fr', 'finance');
---

<BaseLayout
  title={category.title.fr}
  description={category.description.fr}
>
  <section class="border-b border-gray-200/70 bg-gradient-to-b from-white via-gray-50/40 to-white py-16">
    <Container>
      <div class="mx-auto max-w-5xl">
        <Breadcrumbs items={breadcrumbs} />

        <div class="mt-6 text-center">
          <div class="mb-4 inline-flex rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-semibold text-gray-700">Categorie</div>
          <h1 class="mb-4 text-4xl font-bold leading-tight text-black md:text-6xl">{category.h1.fr}</h1>
          <p class="mx-auto max-w-3xl text-lg font-light text-gray-600 md:text-xl">{category.description.fr}</p>
        </div>
      </div>
    </Container>
  </section>

  <section class="section">
    <div class="section-header">
      <div class="section-badge">SEO & Guide</div>
      <h2 class="section-title">Comprendre la categorie {category.name.fr}</h2>
      <p class="section-subtitle">Contenu optimise pour le referencement naturel et la comprehension utilisateur.</p>
    </div>

    <div class="mx-auto max-w-4xl space-y-5 rounded-2xl border border-gray-200 bg-white/95 p-8 leading-relaxed text-gray-700 shadow-sm">
      {category.seoText.fr.map((paragraph) => (
        <p>{paragraph}</p>
      ))}
    </div>
  </section>

  <section class="section">
    <div class="section-header">
      <div class="section-badge">Outils</div>
      <h2 class="section-title">Calculateurs de la categorie</h2>
      <p class="section-subtitle">Accedez rapidement aux outils disponibles pour cette thematique.</p>
    </div>

    {calculators.length > 0 ? (
      <div class="tools-grid">
        {calculators.map((calculator) => (
          <ToolCard
            icon={calculator.icon}
            title={calculator.name.fr}
            description={calculator.description.fr}
            href={getCalculatorRoute('fr', calculator.slug)}
          />
        ))}
      </div>
    ) : (
      <div class="mx-auto max-w-3xl rounded-2xl border border-dashed border-gray-300 bg-white/90 p-8 text-center text-gray-700">
        <p class="text-lg font-medium">Cette categorie est en cours de lancement.</p>
        <p class="mt-2">De nouveaux calculateurs seront publies ici prochainement.</p>
      </div>
    )}

    <div class="mt-8 text-center">
      <a href={primaryCtaHref} class="btn btn-primary inline-flex">{category.ctaLabel.fr}</a>
    </div>
  </section>
</BaseLayout>
